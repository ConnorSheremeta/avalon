<% @playlist = Playlist.find(params[:playlist_id]) %>
<% @current_playlist_item = @playlist.items.where(position: params[:position].to_i).first %>
<% @current_clip = AvalonClip.find(@current_playlist_item.clip_id) %>
<% @current_masterfile = MasterFile.find(@current_playlist_item.clip.source.split('/').last) %>
<% @current_mediaobject = MediaObject.find(@current_masterfile.mediaobject_id) %>
<% clip_start = @current_clip.start_time / 1000.0 %>
<% clip_end = @current_clip.end_time / 1000.0 %>
<% clip_frag = "?t=#{clip_start},#{clip_end}" %>
<% link = pid_section_media_object_path(@current_mediaobject, @current_masterfile.pid) + clip_frag %>
<% target_href = "a[href*='position=#{params[:position]}']".html_safe%>
$('#accordion').replaceWith("<%= escape_javascript(render partial: 'info') %>");
reload_player('<%= @current_masterfile.pid %>', '<%= link %>', <%= @current_masterfile.is_video? %>);
$('.fa-arrow-circle-right').remove();
$('.now_playing').addClass('queue').removeClass('now_playing');
new_now_playing=$($("<%=target_href%>").first().closest('li'));
new_now_playing.addClass('now_playing').removeClass('queue');
new_now_playing.prepend("<i class='fa fa-arrow-circle-right'></i>");