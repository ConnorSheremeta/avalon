<fieldset id='uploader'>
    <legend>Manage file(s)</legend>


		<% unless @masterfiles.nil? %>

	  <table class="table table-striped">
        <thead>
          <th></th>
          <th>Type</th>
          <th>Title</th>
          <th>Filename</th>
          <th>Filesize</th>
          <th>Action</th>
        </thead>
		    <tbody class="sortable">
      		<% @masterfiles.each do |masterfile| %>
  		      <tr>
							<td>
								<div class="noshow">
									<i class="icon-arrow-up"></i>
									<i class="icon-arrow-down"></i> 
								</div>
							</td>
  		        <td>
  		          <% if masterfile.media_type.first == 'audio' %>
	    		      	<i class="icon-volume-up"></i>  		            
  		          <% elsif masterfile.media_type.first == 'video' %>
	    		        <i class="icon-film"></i>
							  <% else %>
							  	<i class="icon-question-sign"></i>
  		          <% end %>
  		        </td>
  		        <td>
  		          <%= text_field_tag masterfile.pid, masterfile.label, class: 'mf-label' %>
  		        </td>
  		        <td>
      	  	   <a href="<%= masterfile.descMetadata.identifier[0] %>"><%= File.basename(masterfile.url.first)  %></a>
      	  	  </td>
      	  	  <td>
      	  	    <strong>(<%= number_to_human_size(masterfile.size) %>)</strong>
      	  	  </td>
      	  	  <td>
      	  	   <% if can? :edit, @mediaobject %>
      	 	     <!-- This should be refactored to act more in line with the typical Twitter bootstrap code at some point -->
          	 		 <% # On a Rails level this needs to be folded into the masterfiles
          	 		    # controller's destroy method to help remove more vestiges of the
          	 		    # catalog controller %>
          	         <%= button_to("Delete", 
          	           master_file_path(masterfile.id), 
          	           :data => { :confirm => "Are you sure you want to delete this file?" }, 
          	           :method => :delete, 
          	           :class => "delete-button btn btn-mini btn-danger") %>
        	 	    <% end %>
      	 	    </td>
    	 	    </tr>
    	 	  <% end %>
  	 	  </tbody>
  	 	</table>

	  <% end %>
    
  	<p>Uploaded files must not exceed <%= number_to_human_size MasterFile::MAXIMUM_UPLOAD_SIZE %></p>

    <%= form_tag(master_files_path, :enctype=>"multipart/form-data", class: "uploader-form form-horizontal step") do -%>
      <input type="hidden" name="container_id" value="<%=h container_id %>"/>
      <input type="hidden" name="step" value="file_upload"/>

      <%= hidden_field_tag("container_content_type", container_content_type, :id => "file_upload_content_type") if defined?(container_content_type) %>

      <%- field_tag_options = defined?(uploader_options) ? uploader_options : {id: nil, multiple: true} %>

      <%= file_field_tag "Filedata[]", field_tag_options %>
      <%= submit_tag("Upload file", :name=>"upload_file", class: "btn") %>

      <%= hidden_field_tag(:new_asset, true, :id => "files_new_asset") if params[:new_asset] %>
      <%= hidden_field_tag("id",params[:id], :id => "file_upload_id") if params[:id] %>
      <%= hidden_field_tag(:original, params[:original], :id => "files_original") %>
    <% end %>
       
</fieldset>

<div class="row-fluid">
  <div class="span8">
    <%= link_to "Continue to #{HYDRANT_STEPS.next(@active_step).title}", 
      edit_media_object_path(@mediaobject, 
        step: HYDRANT_STEPS.next(@active_step).step), 
        class: "btn" %>
  </div>
</div>

<% content_for :page_scripts do %>
  <script>
    /* Hide the alert dialog on the page loading if Javascript is enabled */
    <% unless flash[:upload] %>$('#upload_format').hide();<% end %>
  </script>
<% end %>
