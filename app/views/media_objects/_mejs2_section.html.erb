<% content_for :page_styles do %>
  <% stylesheet_link_tag 'mejs2_player' %>
<% end %>
<% content_for :page_scripts do %>
  <%= javascript_include_tag 'mejs2_player' %>
<% end %>

<section id="content" class="avalon-player" style="width: 100%; visibility: hidden;" tabIndex="-1">
  <% if @currentStream.present? and @currentStream.derivatives.present? %>

    <% if @currentStreamInfo[:is_video] %>
      <%= master_file_meta_properties(@currentStream) do %>
        <video class="mejs-avalon" controls width="450" height="309" style="width: 100%; height: 100%" id="video-tag" poster="<%= @currentStreamInfo[:poster_image] if f_start == 0 %>" preload="auto">
          <% @currentStreamInfo[:stream_flash].each do |flash| %>
            <source src="<%= flash[:url] %>" data-quality="<%= flash[:quality] %>" data-plugin-type="flash" type="video/rtmp"/>
          <% end %>
          <% @currentStreamInfo[:stream_hls].each do |hls| %>
            <source src="<%= hls[:url] %>" data-quality="<%= hls[:quality] %>" data-plugin-type="native" type="application/vnd.apple.mpegURL"/>
          <% end %>
          <% if @currentStreamInfo[:captions_path].present? %>
            <track srclang="en" kind="subtitles" type="<%= @currentStreamInfo[:captions_format] %>" src="<%= @currentStreamInfo[:captions_path] %>"></track>
          <% end %>
        </video>
      <% end %>
    <% else %>
      <%= master_file_meta_properties(@currentStream) do %>
        <audio class="mejs-avalon" controls style="width: 100%;" id="video-tag" preload="true">
          <% @currentStreamInfo[:stream_flash].each do |flash| %>
            <source src="<%= flash[:url] %>" data-quality="<%= flash[:quality] %>" data-plugin-type="flash" type="audio/rtmp"/>
          <% end %>
          <% @currentStreamInfo[:stream_hls].each do |hls| %>
            <source src="<%= hls[:url] %>" data-quality="<%= hls[:quality] %>" data-plugin-type="native" type="application/vnd.apple.mpegURL"/>
          <% end %>
        </audio>
      <% end %>
    <% end %>
  <% end %>
</section>
